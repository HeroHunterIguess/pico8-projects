pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
--a small game by heroâ™¥

playerx=60
playery=125
yvelocity=0
xvelocity=0
gravity=0.16
currentlevel=0
mapx=0
mapy=0

--checking if the tile is collidable
function checkcollision(flag,gmode)
 tilecolumn=flr(playerx/8)
 if gmode==false then
  tilerow=flr(playery/8)
 elseif gmode==true then
  tilerow=flr((playery+1)/8)
 end
 
 spriteatplayer=mget(tilecolumn+mapx,tilerow+mapy)
 
 if fget(spriteatplayer,flag) then
  return true 
 else 
  return false 
 end
end

--check if on ground or solid tile
function ontile()
 if playery==125 then
  return 1
 --check if on up tile
 elseif checkcollision(1,true) then
  return 1
 --check if on left tile
 elseif checkcollision(2,true) then
  return 2
 --check if on right tile
 elseif checkcollision(3,true) then
  return 3
 --check if on down tile
 elseif checkcollision(4,true) then
  return 4
 --check if on exit tile
 elseif checkcollision(5,true) then
  return 5
 else
  return 0
 end
end

--reset and move to nxt lvl
function nextlevel()
 currentlevel+=1
 mapx+=16
 playerx=60
 playery=126
end

--runs every frame
function _update()
 --get player inputs
 if btn(0) then
  xvelocity-=0.2
 elseif btn(1) then
  xvelocity+=0.2
 else
 xvelocity*=0.05 end

 --set max velocities
 if xvelocity>2 then
  xvelocity=2 end
 if xvelocity<-2 then
  xvelocity=-2 end
 if yvelocity>10 then
  yvelocity=10 end
 if yvelocity<-10 then
  yvelocity=-10 end

 --keeping playery in bounds
 --temporary limit at 126 !!
 if playery>=126 then
  playery=126
 end
	
 --keeping playerx in bounds
 if playerx<2 then
  playerx=2
  xvelocity*=0.01
 end
 if playerx>126 then
  playerx=126
  xvelocity*=0.01
 end
		
 --check spike collisions
 if checkcollision(0,false) then
  yvelocity=0
  xvelocity=0
  playerx=60
  playery=126
 end

 --check direction tiles
	
 --check if in up tile
 if ontile()==1 then
  playery-=2
  yvelocity=-1.25
 end
 --check if in left tile
 if ontile()==2 then
  playerx-=2
  playery-=0.1
  xvelocity=-1.25
  yvelocity=-0.5
 end
 --check if in right tile
 if ontile()==3 then
  playerx+=2
  playery-=0.1
  xvelocity=1.25
  yvelocity=-0.5
 end
 --check if in down tile
 if ontile()==4 then
  playery+=2.25
  yvelocity=1.25
 end
 --check if in exit tile
 if ontile()==5 then
  nextlevel()
 end
	
 --update movement
 yvelocity+=gravity
 playery+=yvelocity
 playerx+=xvelocity
end

--drawing on screen every frame
function _draw()
 cls(0)
 
 --rendering the level
 map(mapx,mapy,0,0,16,32)
 
 --drawing player
 rectfill(playerx-1,playery-1,playerx+1,playery+1,9)
end

__gfx__
000000001cccccc11cccccc118888881133333311bbbbbb11dddddd1122222211111111100000000000000000000000000000000000000000000000000000000
00000000ccccccccccc66ccc86888868333b3333bbbb3bbbddd66ddd2eeeeee21111111100000000000000000000000000000000000000000000000000000000
00700700cccccccccc6666cc8868868833b33333bbbbb3bbddd66ddd2eeeeee21111111100000000000000000000000000000000000000000000000000000000
00077000ccccccccc6c66c6c888668883bbbbbb3b333333bddd66ddd2eeeeee21111111100000000000000000000000000000000000000000000000000000000
00077000ccccccccccc66ccc888668883bbbbbb3b333333bd6d66d6d2eeeeee21111111100000000000000000000000000000000000000000000000000000000
00700700ccccccccccc66ccc8868868833b33333bbbbb3bbdd6666dd2eeeeee21111111100000000000000000000000000000000000000000000000000000000
00000000ccccccccccc66ccc86888868333b3333bbbb3bbbddd66ddd2eeeeee21111111100000000000000000000000000000000000000000000000000000000
00000000cccccccc1cccccc118888881133333311bbbbbb11dddddd1122222211111111100000000000000000000000000000000000000000000000000000000
__gff__
0002020104081020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080308080808080808080808030808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080308080808080808080808030808080800080808000800080008080800080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808030704040802080808080808080707080808080808080308080808080808080808030603030200000800000800080008000800000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080807080808080808080808080808080308080802080808080808080202080808080808080306040408080808080808030608030200000800000808080008080800000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080802080808080808080808080808080308080802080808080808080202080808080808080306030303030208080808030608030200000800000800080008000800000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080802080808080505050505050508060308080802080808080808080202080808080808080306030808030208080808030608030200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808020802020202020202020202080808080208080808080803060308080802080808080808080202080808080808080306030808030208080808080808030200000800080800000008080800080008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808020808080808080808080808080808080208080808080803060308080802080203030302080808080203030302080306030808030808080204040408030200000800080000000008000800080008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808020808080808080808080808080808080208080808080803060308080802080208080808080808080808080802080306030303030303030303030303030200000800000800000008080800080008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808020808080808080808080808080808080208080808080803060308080802080208080808080808080808080802080308080703080808080808080808030200000800080000000008000800080008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808020802020202020802080808080808080208080808080803080808080802080208080808080808080808080802080302020803080808080808080808030200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080802080808080808080202020202080803020202020202080208040404080808080505050802080303030303080808080808080808030200000800000800080008080800080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080802080808080808080808080802080803080808080808080808080802080808080208080808080308080808080808080808080808030200000800000808080008000800080008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080802080808080808080808080802080803080808080808080808080802080808080208080808080308080808080808080808080808030200000800000800080008080800080008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080802080808080808080808080802080803080808080808080808080802040808050208080808080308080808080808080808080808080200000808000800080008000800080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
